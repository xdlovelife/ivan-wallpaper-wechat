"use strict";var t=this&&this.__awaiter||function(t,o,s,c){return new(s=s||Promise)(function(n,e){function a(t){try{r(c.next(t))}catch(t){e(t)}}function i(t){try{r(c.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(a,i)}r((c=c.apply(t,o||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Pointer=exports.createPointer=void 0;const a=require("./tools"),i=require("../interface/calendar"),e=require("../interface/component"),n=t=>Object.assign({x:0,y:0,show:!1,animate:!0,transition:!0},t),r=(exports.createPointer=n,(t,e)=>{const{month:n,day:a}=e;e=(0,i.findDateIndex)(t.weeks,t=>t.month==n&&t.day==a);return{ddx:e%7,wdx:Math.floor(e/7),len:t.weeks.length}}),o=(t,e,n)=>{var{ddx:t,wdx:e,len:a}=r(t,e);return{x:n[t]+"px",y:`calc(100% / ${a} * ${e})`}};class s extends e.CalendarHandler{constructor(){super(...arguments),this.show=!0}update(t,e=!1,n,a=!1){var i=this._instance_,r=(n=n||(null==t?void 0:t.checked)||i.data.checked,null!=(r=null==t?void 0:t.current)?r:i.data.current),r=null!=t&&t.panels?t.panels[r]:(null==t?void 0:t[`panels[${r}]`])||i.data.panels[r],{x:e,y:r}=(this._vibrate_=e,o(r,n,i._centres_));null!=t&&t.pointer?t.pointer=Object.assign(Object.assign({},t.pointer),{x:e,y:r,show:this.show,animate:!0}):t?(t["pointer.x"]=e,t["pointer.y"]=r,t["pointer.show"]=this.show,t["pointer.animate"]=!a):i.setData({"pointer.x":e,"pointer.y":r,"pointer.show":this.show,"pointer.animate":!a})}animationEnd(){var t=this._instance_;t.setData({"pointer.animate":!1}),t.data.vibrate&&this._vibrate_&&this.show&&wx.vibrateShort({type:"light"})}resetOffsetY(n){return t(this,void 0,void 0,function*(){var t=this._instance_,e=t._calendar_.createMonth(n,t.data.weekstart),e=o(e,n,t._centres_)["y"];t.setData({"pointer.y":e,"pointer.show":!1,"pointer.animate":!1}),yield(0,a.nextTick)()})}}exports.Pointer=s;