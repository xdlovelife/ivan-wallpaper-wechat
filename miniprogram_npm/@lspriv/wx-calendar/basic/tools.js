"use strict";var t=this&&this.__awaiter||function(e,n,l,a){return new(l=l||Promise)(function(r,t){function o(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(o,i)}s((a=a.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasLayoutArea=exports.addLayoutHideCls=exports.layoutHideCls=exports.onceEmiter=exports.mergeStr=exports.viewportOffset=exports.nodeRect=exports.clearAnimated=exports.applyAnimated=exports.severalTicks=exports.nextTick=exports.InitWeeks=exports.InitPanels=exports.circularDiff=exports.isSkyline=exports.middle=exports.flagView=exports.isView=exports.viewFlag=void 0;const i=require("./constants"),r=require("../utils/shared"),e=(e,t=i.VIEWS.MONTH)=>{e=(null==(e=e.match(/^(\w+)(?:-fixed)?$/))?void 0:e[1])||t;return Math.max(0,1<<(0,r.values)(i.VIEWS).indexOf(e))},o=(exports.viewFlag=e,e=>e===i.View.week||e===i.View.month||e===i.View.schedule),s=(exports.isView=o,e=>(0,r.values)(i.VIEWS)[Math.log2(e)]),n=(exports.flagView=s,e=>Math.floor((e-1)/2)),l=(exports.middle=n,e=>"skyline"===e),a=(exports.isSkyline=l,(e,t)=>{var r=Math.floor(i.CALENDAR_PANELS/2);return e<t-r&&(e+=i.CALENDAR_PANELS),t+r<e&&(e-=i.CALENDAR_PANELS),e-t}),p=(exports.circularDiff=a,(r,o={})=>Array.from({length:i.CALENDAR_PANELS},(e,t)=>Object.assign({key:r+"_"+t},o))),c=(exports.InitPanels=p,(r=i.WEEKS,o="w")=>Array.from({length:r.length},(e,t)=>({key:o+"_"+t,label:r[t]}))),x=(exports.InitWeeks=c,t=>new Promise(e=>{wx.nextTick(()=>{e(null==t?void 0:t())})})),u=(exports.nextTick=x,e=>t(void 0,void 0,void 0,function*(){for(;;){if(!e)break;yield(0,exports.nextTick)(),e--}})),d=(exports.severalTicks=u,(e,r,o,i)=>new Promise(t=>{e.applyAnimatedStyle(r,o,i,e=>{t(e.styleId)})})),f=(exports.applyAnimated=d,(t,r,o)=>new Promise(e=>{t.clearAnimatedStyle(r,o,()=>{e()})})),w=(exports.clearAnimated=f,e=>{const i=e.createSelectorQuery().in(e);return o=>new Promise((t,r)=>{i.selectAll(o).boundingClientRect(e=>{e.length?t(e):r("view not found by selector "+o)}).exec()})}),m=(exports.nodeRect=w,t=>new Promise(e=>{t.createSelectorQuery().selectViewport().scrollOffset(e).exec()})),y=(exports.viewportOffset=m,(e,t=",")=>e.flatMap(e=>e.split(t).map(e=>e.trim())).join(t)),h=(exports.mergeStr=y,(t,r)=>{let o=0;return{emit:function(...e){o||(t.triggerEvent(r,...e),o++)},cancel:function(){o++}}}),A=(exports.onceEmiter=h,t=>{return null!=t&&t.length?i.FULL_LAYOUT.filter(e=>!t.includes(e)).map(e=>"wc--hide-"+e).join(" "):""}),v=(exports.layoutHideCls=A,(e,t)=>{return new RegExp(`wc--hide-${t}\\s*`).test(e)?e:e+" wc--hide-"+t}),g=(exports.addLayoutHideCls=v,(e,t)=>!new RegExp(`wc--hide-${t}\\s*`).test(e));exports.hasLayoutArea=g;