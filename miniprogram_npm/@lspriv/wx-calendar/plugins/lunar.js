"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LUNAR_PLUGIN_KEY=exports.LunarPlugin=void 0;const i=require("../basic/constants"),c=require("../interface/calendar"),l=[0,4,173,8,90,1,213,84,180,9,100,5,89,69,149,10,166,4,85,36,173,8,90,98,218,4,180,5,180,85,82,13,148,10,74,42,86,2,109,113,109,1,218,2,210,82,169,5,73,13,42,69,43,9,86,1,181,32,109,1,89,105,212,10,168,5,169,86,165,4,43,9,158,56,182,8,236,116,108,5,212,10,228,106,82,5,149,10,90,66,91,4,182,4,180,34,106,5,82,117,201,10,82,5,53,85,77,10,90,2,93,49,181,2,106,138,104,5,169,10,138,106,42,5,45,9,170,72,90,1,181,9,176,57,100,5,37,117,149,10,150,4,77,84,173,4,218,4,212,68,180,5,84,133,82,13,146,10,86,106,86,2,109,2,106,65,218,2,178,161,169,5,73,13,10,109,42,9,86,1,173,80,109,1,217,2,209,58,168,5,41,133,165,12,42,9,150,84,182,8,108,9,100,69,212,10,164,5,81,37,149,10,42,114,91,4,182,4,172,82,106,5,210,10,162,74,74,5,85,148,45,10,90,2,117,97,181,2,106,3,97,69,169,10,74,5,37,37,45,9,154,104,218,8,180,9,168,89,84,3,165,10,145,58,150,4,173,176,173,4,218,4,244,98,180,5,84,11,68,93,82,10,149,4,85,34,109,2,90,113,218,2,170,5,178,85,73,11,74,10,45,57,54,1,109,128,109,1,217,2,233,106,168,5,41,11,154,76,170,8,182,8,180,56,108,9,84,117,212,10,164,5,69,85,149,10,154,4,85,68,181,4,106,130,106,5,210,10,146,106,74,5,85,10,42,74,90,2,181,2,178,49,105,3,49,115,169,10,74,5,45,85,45,9,90,1,213,72,180,9,104,137,84,11,164,10,165,106,149,4,173,8,106,68,218,4,116,5,176,37,84,3],s=[6,14,19,25,33,36,38,41,44,52,55,79,117,136,147,150,155,158,185,193],n=[[7,6,6,6,6,6,6,6,6,5,6,6,6,5,5,6,6,5,5,5,5,5,5,5,5,4,5,5],[5,4,5,5,5,4,4,5,5,4,4,4,4,4,4,4,4,3,4,4,4,3,3,4,4,3,3,3],[6,6,6,7,6,6,6,6,5,6,6,6,5,5,6,6,5,5,5,6,5,5,5,5,4,5,5,5,5],[5,5,6,6,5,5,5,6,5,5,5,5,4,5,5,5,4,4,5,5,4,4,4,5,4,4,4,4,5],[6,6,6,7,6,6,6,6,5,6,6,6,5,5,6,6,5,5,5,6,5,5,5,5,4,5,5,5,5],[6,6,7,7,6,6,6,7,6,6,6,6,5,6,6,6,5,5,6,6,5,5,5,6,5,5,5,5,4,5,5,5,5],[7,8,8,8,7,7,8,8,7,7,7,8,7,7,7,7,6,7,7,7,6,6,7,7,6,6,6,7,7],[8,8,8,9,8,8,8,8,7,8,8,8,7,7,8,8,7,7,7,8,7,7,7,7,6,7,7,7,6,6,7,7,7],[8,8,8,9,8,8,8,8,7,8,8,8,7,7,8,8,7,7,7,8,7,7,7,7,6,7,7,7,7],[9,9,9,9,8,9,9,9,8,8,9,9,8,8,8,9,8,8,8,8,7,8,8,8,7,7,8,8,8],[8,8,8,8,7,8,8,8,7,7,8,8,7,7,7,8,7,7,7,7,6,7,7,7,6,6,7,7,7],[7,8,8,8,7,7,8,8,7,7,7,8,7,7,7,7,6,7,7,7,6,6,7,7,6,6,6,7,7]],o=[[13,49,85,117,149,185,201,250,250],[13,45,81,117,149,185,201,250,250],[13,48,84,112,148,184,200,201,250],[13,45,76,108,140,172,200,201,250],[13,44,72,104,132,168,200,201,250],[5,33,68,96,124,152,188,200,201],[29,57,85,120,148,176,200,201,250],[13,48,76,104,132,168,196,200,201],[25,60,88,120,148,184,200,201,250],[16,44,76,108,144,172,200,201,250],[28,60,92,124,160,192,200,201,250],[17,53,85,124,156,188,200,201,250]],u=[[21,21,21,21,21,20,21,21,21,20,20,21,21,20,20,20,20,20,20,20,20,19,20,20,20,19,19,20],[20,19,19,20,20,19,19,19,19,19,19,19,19,18,19,19,19,18,18,19,19,18,18,18,18,18,18,18],[21,21,21,22,21,21,21,21,20,21,21,21,20,20,21,21,20,20,20,21,20,20,20,20,19,20,20,20,20],[20,21,21,21,20,20,21,21,20,20,20,21,20,20,20,20,19,20,20,20,19,19,20,20,19,19,19,20,20],[21,22,22,22,21,21,22,22,21,21,21,22,21,21,21,21,20,21,21,21,20,20,21,21,20,20,20,21,21],[22,22,22,22,21,22,22,22,21,21,22,22,21,21,21,22,21,21,21,21,20,21,21,21,20,20,21,21,21],[23,23,24,24,23,23,23,24,23,23,23,23,22,23,23,23,22,22,23,23,22,22,22,23,22,22,22,22,23],[23,24,24,24,23,23,24,24,23,23,23,24,23,23,23,23,22,23,23,23,22,22,23,23,22,22,22,23,23],[23,24,24,24,23,23,24,24,23,23,23,24,23,23,23,23,22,23,23,23,22,22,23,23,22,22,22,23,23],[24,24,24,24,23,24,24,24,23,23,24,24,23,23,23,24,23,23,23,23,22,23,23,23,22,22,23,23,23],[23,23,23,23,22,23,23,23,22,22,23,23,22,22,22,23,22,22,22,22,21,22,22,22,21,21,22,22,22],[22,22,23,23,22,22,22,23,22,22,22,22,21,22,22,22,21,21,22,22,21,21,21,22,21,21,21,21,22]],h=[[13,45,81,113,149,185,201],[21,57,93,125,161,193,201],[21,56,88,120,152,188,200,201],[21,49,81,116,144,176,200,201],[17,49,77,112,140,168,200,201],[28,60,88,116,148,180,200,201],[25,53,84,112,144,172,200,201],[29,57,89,120,148,180,200,201],[17,45,73,108,140,168,200,201],[28,60,92,124,160,192,200,201],[16,44,80,112,148,180,200,201],[17,53,88,120,156,188,200,201]],e="甲乙丙丁戊己庚辛壬癸",t="子丑寅卯辰巳午未申酉戌亥",a="鼠牛虎兔龙蛇马羊猴鸡狗猪",A="正二三四五六七八九十冬腊",M=["大寒","雨水","春分","谷雨","小满","夏至","大暑","处暑","秋分","霜降","小雪","冬至"],E=["小寒","立春","惊蛰","清明","立夏","芒种","小暑","立秋","白露","寒露","立冬","大雪"],N="〇一二三四五六七八九十",_={YEAR:1901,MONTH:1,DAY:1,INDEX:0,CN_YEAR:4597,CN_MONTH:11,CN_DAY:11},Y=[{solar:E[2],year:2014,month:3,wrong:5,correct:6},{solar:M[2],year:2051,month:3,wrong:21,correct:20},{solar:E[1],year:2083,month:2,wrong:4,correct:3},{solar:M[2],year:2084,month:3,wrong:20,correct:19},{solar:E[5],year:2094,month:6,wrong:6,correct:5}],f=r=>r<0?Math.ceil(r)||0:Math.floor(r);class v{static lunar(o,l,s){var r=v.reviseSolarTerm(o,l,s);let u=void 0,i=void 0,c=void 0,h=void 0,N=void 0;if(1901<=o&&o<2100){let r=_.YEAR,e=_.MONTH,t=_.DAY;u=_.CN_YEAR,i=_.CN_MONTH,c=_.CN_DAY,2e3<=o&&(r=_.YEAR+99,e=1,t=1,u=_.CN_YEAR+99,i=11,c=25);var Y=new Date(r,e-1,t),y=new Date(o,l-1,s),y=f((+y-+Y)/864e5);c+=y;let a=v.cnMonthDays(u,i),n=v.nextCnMonth(u,i);for(;c>a;)Math.abs(n)<Math.abs(i)&&u++,i=n,c-=a,a=v.cnMonthDays(u,i),n=v.nextCnMonth(u,i);h=v.sectionalTerm(o,l),N=v.principleTerm(o,l)}let e=v.lunarDay(c),t="";return s===h?t=E[l-1]:s===N?t=M[l-1]:1===c&&0<i?e=A[i-1]+"月":1===c&&i<0&&(e=`闰${A[-i-1]}月`),!0===r?t="":r&&(t=r),{year:u,month:i,day:c,lunarYear:v.lunarYear(u),lunarMonth:v.lunarMonth(i),lunarDay:e,solar:t}}static sectionalTerm(r,e){if(r<1901||2100<r)return 0;let t=0;for(var a=r-_.YEAR+1;a>=o[e-1][t];)t++;return n[e-1][4*t+a%4]}static principleTerm(r,e){if(r<1901||2100<r)return 0;let t=0;for(var a=r-_.YEAR+1;a>=h[e-1][t];)t++;return u[e-1][4*t+a%4]}static reviseSolarTerm(e,r,t){var a=Y.find(r=>r.year==e);if((null==a?void 0:a.month)===r){if(a.wrong===t)return!0;if(a.correct===t)return a.solar}return!1}static lunarYear(r){return r?e[(r-1)%10]+t[(r-1)%12]+a[(r-1)%12]+"年":""}static lunarMonth(r){return null==r?"":0<r?A[r-1]+"月":`闰${A[-r-1]}月`}static lunarDay(r){return r?0<r&&r<=10?"初"+N[r]:r<20?"十"+N[r%10]:20==r?"二十":r<30?"廿"+N[r%10]:30===r?"三十":"":""}static nextCnMonth(r,e){let t=Math.abs(e)+1;return t=13==(t=0<e&&(r=r-_.CN_YEAR+_.INDEX,(l[2*r+1]>>4&15)==e)?-e:t)?1:t}static cnMonthDays(r,e){var t=r-_.CN_YEAR+_.INDEX;let a=0,n=0,o=30;if(1<=e&&e<=8)a=l[2*t],n=e-1,1==(a>>n&1)&&(o=29);else if(9<=e&&e<=12)a=l[2*t+1],n=e-9,1==(a>>n&1)&&(o=29);else if((a=(a=l[2*t+1])>>4&15)!=Math.abs(e))o=0;else{o=29;for(let r=0;r<s.length;r++)if(s[r]==t){o=30;break}}return o}}class r{getLunar(r){return v.lunar(r.year,r.month,r.day)}PLUGIN_TRACK_DATE(r){r=v.lunar(r.year,r.month,r.day);return{festival:{text:r.solar||r.lunarDay,color:r.solar?"var(--wc-solar-color)":null}}}PLUGIN_TRACK_YEAR(e){let t="";var a=new Map;for(let r=0;r<12;r++){var n=1===r&&(0,c.isLeapYear)(e.year)?i.GREGORIAN_MONTH_DAYS[r]+1:i.GREGORIAN_MONTH_DAYS[r],o=r+1;for(let r=0;r<n;r++){var l,s=r+1,u=v.lunar(e.year,o,s);10===o&&1===s&&(t=u.lunarYear),1===u.day&&(s=(0,c.getAnnualMarkKey)({month:o,day:s}),(l={}).sub=1===u.month?"#F56C6C":"#409EFF",a.set(s,l))}}return{subinfo:[{text:t,color:"#F56C6C"},{text:"农历初一",color:"#409EFF"}],marks:a}}}(exports.LunarPlugin=r).KEY="lunar",exports.LUNAR_PLUGIN_KEY=r.KEY;